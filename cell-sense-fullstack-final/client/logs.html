<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Logs | Cell Sense</title>
  <link href="assets/css/material-dashboard.css" rel="stylesheet">
  <link href="assets/css/nucleo-icons.css" rel="stylesheet">
  <link href="assets/css/fontawesome.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.material.css">
</head>
<body class="g-sidenav-show sidenav-pinned bg-gray-100">

  <!-- Sidebar (same as dashboard.html) -->
  <aside class="sidenav navbar navbar-vertical bg-gradient-dark fixed-start">
    <div class="sidenav-header text-center">
      <img id="sidebarAvatar" src="default.jpg" class="avatar avatar-sm border-radius-lg shadow-sm mt-3 mb-2">
      <h6 id="sidebarUsername" class="text-white">User</h6>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link text-white active bg-gradient-primary" href="dashboard.html"><i class="material-icons opacity-10">Dashboard</i><span class="nav-link-text ms-2"></span></a></li>
      <li class="nav-item"><a class="nav-link text-white" href="logs.html"><i class="material-icons opacity-10">Log</i><span class="nav-link-text ms-2"></span></a></li>
      <li class="nav-item"><a class="nav-link text-white" href="medication.html"><i class="material-icons opacity-10">Medication</i><span class="nav-link-text ms-2"></span></a></li>
      <li class="nav-item"><a class="nav-link text-white" href="insights.html"><i class="material-icons opacity-10">Insights</i><span class="nav-link-text ms-2"></span></a></li>
      <li class="nav-item"><a class="nav-link text-white" href="profile.html"><i class="material-icons opacity-10">Profile</i><span class="nav-link-text ms-2"></span></a></li>
      <li class="nav-item mt-3"><a class="nav-link text-white" href="login.html"><i class="material-icons opacity-10">Logout</i><span class="nav-link-text ms-2"></span></a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container-fluid py-4">
      <div class="row">

        <!-- Pain Log -->
        <div class="col-md-6 mb-4">
          <div class="card card-body">
            <h6 class="mb-3"><i class="material-icons text-danger me-1">report</i> Log Pain Episode</h6>
            <form id="painLogForm" class="row g-3">
              <div class="col-6">
                <label class="form-label">Intensity (1â€“10)</label>
                <input type="number" id="painLevel" class="form-control" min="1" max="10" required />
              </div>
              <div class="col-6">
                <label class="form-label">Note (optional)</label>
                <input type="text" id="painNote" class="form-control" />
              </div>
              <div class="col-12">
                <button type="submit" class="btn btn-outline-danger w-100">Log Pain</button>
              </div>
            </form>
            <ul id="painLogList" class="list-group mt-3"></ul>
          </div>
        </div>

        <!-- Medication Reminders -->
        <div class="col-md-6 mb-4">
          <div class="card card-body">
            <h6 class="mb-3"><i class="material-icons text-primary me-1">alarm</i> Medication Reminders</h6>
            <form id="medReminderForm" class="row g-3">
              <div class="col-8">
                <label class="form-label">Medication Name</label>
                <input type="text" id="medName" class="form-control" required />
              </div>
              <div class="col-4">
                <label class="form-label">Time</label>
                <input type="time" id="medTime" class="form-control" required />
              </div>
              <div class="col-12">
                <button type="submit" class="btn btn-outline-primary w-100">Add Reminder</button>
              </div>
            </form>
            <ul id="medReminderList" class="list-group mt-3"></ul>
          </div>
        </div>

      </div>
    </div>
  </main>

  <script>
    const API = 'http://localhost:5000/api';
    const token = localStorage.getItem("token");

    const user = JSON.parse(localStorage.getItem('user') || '{}');
    document.getElementById('sidebarAvatar').src = user.profilePic || 'default.jpg';
    document.getElementById('sidebarUsername').textContent = user.name || 'User';

    document.addEventListener('DOMContentLoaded', () => {
      document.body.classList.remove('sidenav-mini', 'g-sidenav-hidden');
      document.body.classList.add('sidenav-pinned', 'g-sidenav-show');
      const sidenav = document.querySelector('.sidenav');
      if (sidenav) {
        sidenav.addEventListener('mouseenter', e => {
          e.stopPropagation();
          document.body.classList.remove('sidenav-mini', 'g-sidenav-hidden');
        });
        sidenav.addEventListener('mouseleave', e => {
          e.stopPropagation();
          document.body.classList.remove('sidenav-mini', 'g-sidenav-hidden');
        });
      }
    });
    

    document.getElementById('painLogForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const intensity = document.getElementById('painLevel').value;
      const note = document.getElementById('painNote').value;
      const res = await fetch(`${API}/pain`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ intensity, note })
      });
      if (res.ok) {
        loadPainLogs();
        e.target.reset();
      }
    });

    async function loadPainLogs() {
      const res = await fetch(`${API}/pain`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const logs = await res.json();
      const list = document.getElementById('painLogList');
      list.innerHTML = '';
      logs.forEach(log => {
        const li = document.createElement('li');
        li.className = "list-group-item";
        li.textContent = `Intensity: ${log.intensity} - ${log.note || 'No note'} (${new Date(log.createdAt).toLocaleString()})`;
        list.appendChild(li);
      });
    }

    document.getElementById('medReminderForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('medName').value;
      const time = document.getElementById('medTime').value;
      const res = await fetch(`${API}/meds`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ name, time })
      });
      if (res.ok) {
        loadMedReminders();
        e.target.reset();
      }
    });

    async function loadMedReminders() {
      const res = await fetch(`${API}/meds`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const meds = await res.json();
      const list = document.getElementById('medReminderList');
      list.innerHTML = '';
      meds.forEach(med => {
        const li = document.createElement('li');
        li.className = "list-group-item";
        li.textContent = `${med.name} at ${med.time}`;
        list.appendChild(li);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadPainLogs();
      loadMedReminders();
    });
  </script>
</body>
</html>
